# 딸기 이중 카메라 분류 시스템 (Strawberry Dual Camera Sorter)

## 개요
Top 카메라와 Side 카메라를 이용한 딸기의 3D 부피 추정 및 크기 분류 시스템입니다.

## 주요 기능
- 이중 카메라(Top+Side) 실시간 캡처
- 딸기 객체 자동 검출 및 분할
- 3D 부피 추정 알고리즘 (4가지 방법)
- 크기별 분류 (소형, 중형, 대형, 특대형)
- 품질 등급 평가 (A+, A, B+, B, C+, C, D)
- 실시간 결과 표시 및 저장

## 프로젝트 구조
```
strawberry-dualcam-sorter/
├─ src/
│   ├─ main.py              # 메인 실행 파일
│   ├─ calibration.py       # 카메라 캘리브레이션
│   ├─ measurement.py       # 부피 측정
│   ├─ classify.py          # 크기 분류
│   └─ utils.py             # 유틸리티 함수
├─ config/
│   └─ settings.yaml        # 설정 파일
├─ data/
│   └─ samples/             # 테스트 이미지/영상
├─ logs/                    # 결과 및 로그 저장
├─ requirements.txt         # 의존성 패키지
├─ README.md               # 프로젝트 문서
└─ .gitignore              # Git 무시 파일
```

## 설치 방법

### 1. 의존성 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. 프로젝트 실행
```bash
python src/main.py
```

## 사용 방법

### 기본 실행
```bash
python src/main.py
```

### 설정 파일 수정
`config/settings.yaml` 파일을 수정하여 다음을 설정할 수 있습니다:
- 카메라 ID 및 해상도
- 검출 파라미터
- 분류 기준
- 부피 추정 설정

### 조작법
- **'q'**: 프로그램 종료
- **'s'**: 결과 저장
- **'c'**: 캘리브레이션 정보 표시

## 카메라 설정

### 하드웨어 요구사항
- 2개의 USB 카메라 (Top 카메라, Side 카메라)
- 충분한 조명 환경
- 안정적인 카메라 마운트

### 카메라 배치
- **Top 카메라**: 딸기 위쪽에서 수직으로 촬영
- **Side 카메라**: 딸기 옆쪽에서 수평으로 촬영
- 두 카메라 간 적절한 거리 유지

## 캘리브레이션

### 체스보드 캘리브레이션
1. 9x6 체스보드 패턴 준비
2. 두 카메라로 체스보드 촬영 (최소 10장)
3. 캘리브레이션 이미지를 `data/samples/` 폴더에 저장
4. 캘리브레이션 수행

### 캘리브레이션 이미지 명명 규칙
- Top 카메라: `top_001.jpg`, `top_002.jpg`, ...
- Side 카메라: `side_001.jpg`, `side_002.jpg`, ...

## 분류 기준

### 크기 분류 (부피 기준)
- **소형**: 0 ~ 15,000 mm³
- **중형**: 15,000 ~ 30,000 mm³
- **대형**: 30,000 ~ 50,000 mm³
- **특대형**: 50,000 mm³ 이상

### 품질 등급
- **A+**: 우수한 품질, 높은 신뢰도
- **A**: 양호한 품질
- **B+**: 보통 품질
- **B**: 일반 품질
- **C+**: 낮은 품질
- **C**: 매우 낮은 품질
- **D**: 불량

## 부피 추정 방법

1. **타원체 근사법**: 딸기를 타원체로 근사하여 부피 계산
2. **구형 근사법**: 딸기를 구로 근사하여 부피 계산
3. **윤곽선 기반**: 윤곽선을 이용한 3D 모델 생성
4. **깊이 추정법**: 카메라 각도를 고려한 깊이 추정

## 출력 결과

### 실시간 표시
- Top/Side 카메라 화면
- 검출된 딸기 위치 및 크기
- 분류 결과 (크기, 등급)
- 부피 정보

### 저장 파일
- **JSON 결과**: `logs/analysis_YYYYMMDD_HHMMSS.json`
- **이미지**: 검출 및 분류 결과 이미지
- **통계**: 분류 통계 및 요약

## 문제 해결

### 카메라 인식 문제
- 카메라 ID 확인 (0, 1)
- USB 연결 상태 점검
- 다른 프로그램에서 카메라 사용 중인지 확인

### 검출 정확도 문제
- 조명 환경 개선
- 카메라 초점 조정
- 검출 파라미터 조정 (`config/settings.yaml`)

### 부피 측정 오차
- 캘리브레이션 재수행
- 픽셀/mm 비율 조정
- 카메라 위치 재조정

## 개발자 정보

### 기술 스택
- **Python 3.7+**
- **OpenCV**: 이미지 처리 및 카메라 제어
- **NumPy**: 수치 계산
- **PyYAML**: 설정 파일 관리

### 확장 가능성
- 새로운 검출 알고리즘 추가
- 분류 기준 커스터마이징
- 추가 카메라 지원
- 웹 인터페이스 개발

## 라이선스
이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 기여하기
버그 리포트, 기능 요청, 풀 리퀘스트를 환영합니다.

## 연락처
프로젝트 관련 문의사항이 있으시면 이슈를 생성해 주세요.
